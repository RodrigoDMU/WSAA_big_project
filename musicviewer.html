<!DOCTYPE html>
<html>

<head>
    <title>View Music</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>

<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">List of Musics</h1>
        <button id="showAddButton" class="btn btn-primary mb-3" onclick="showCreate()">
            <i class="bi bi-plus-circle"></i> Add Music
        </button>

        <table class="table table-striped" id="musicTable">
            <thead class="thead-light">
                <tr>
                    <th>ID</th>
                    <th>Artist</th>
                    <th>Title</th>
                    <th>Minutes</th>
                    <th>Year</th>
                    <th>Category</th>
                    <th>Update</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="createUpdateForm" class="container p-4" style="display: none; max-width: 600px; background: #f8f9fa; border-radius: 8px;">
        <h2 class="mb-4">
            <span id="createLabel">Add a New Music</span>
            <span id="updateLabel" style="display:none;">Update</span>
        </h2>
        <input type="hidden" name="id" />

        <div class="mb-3">
            <label for="artistInput" class="form-label">Artist</label>
            <input id="artistInput" type="text" name="artist" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="titleInput" class="form-label">Title</label>
            <input id="titleInput" type="text" name="title" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="minutesInput" class="form-label">Minutes</label>
            <input id="minutesInput" type="number" name="minutes" class="form-control" />
        </div>

        <div class="mb-3">
            <label for="yearInput" class="form-label">Year</label>
            <input id="yearInput" type="number" name="year" class="form-control" />
        </div>

        <div class="mb-4">
            <label for="categorySelect" class="form-label">Category</label>
            <select name="category" class="form-control" required>
                <option value="">-- Select Category --</option>
                <option value="Blues">Blues</option>
                <option value="Classical">Classical</option>
                <option value="Contemporary R&B">Contemporary R&B</option>
                <option value="Country">Country</option>
                <option value="Disco">Disco</option>
                <option value="Electronic">Electronic</option>
                <option value="Gospel">Gospel</option>
                <option value="Hip Pop">Hip Pop</option>
                <option value="Jazz">Jazz</option>
                <option value="Pop">Pop</option>
                <option value="Reggae">Reggae</option>
                <option value="Rock">Rock</option>
                <option value="Soul Music">Soul Music</option>
                <option value="Others">Others</option>
            </select>
        </div>

        <div class="d-flex gap-3 mb-3">
            <button id="doCreateButton" class="btn btn-primary" onclick="doCreate()">
                <i class="bi bi-plus-lg"></i> Add
            </button>
            <button id="doUpdateButton" class="btn btn-warning text-white" onclick="doUpdate()" style="display:none;">
                <i class="bi bi-pencil-square"></i> Update
            </button>
            <button class="btn btn-secondary" onclick="cancel()">
                <i class="bi bi-x-circle"></i> Cancel
            </button>
        </div>
    </div>

    <script>
        function showCreate() {
            document.getElementById('showAddButton').style.display = "none";
            document.getElementById('musicTable').style.display = "none";
            document.getElementById('createUpdateForm').style.display = "block";
            document.getElementById('createLabel').style.display = "inline";
            document.getElementById('updateLabel').style.display = "none";
            document.getElementById('doCreateButton').style.display = "inline-block";
            document.getElementById('doUpdateButton').style.display = "none";
            clearForm();
        }

        function showViewAll() {
            document.getElementById('showAddButton').style.display = "inline-block";
            document.getElementById('musicTable').style.display = "table";
            document.getElementById('createUpdateForm').style.display = "none";
        }

        function doCreate() {
            const form = document.getElementById('createUpdateForm');
            const music = {
                artist: form.querySelector('input[name="artist"]').value,
                title: form.querySelector('input[name="title"]').value,
                minutes: form.querySelector('input[name="minutes"]').value,
                year: parseInt(form.querySelector('input[name="year"]').value, 10),
                category: form.querySelector('select[name="category"]').value
            };
            createMusicAjax(music);
        }

        function clearForm() {
            const form = document.getElementById('createUpdateForm');
            form.querySelector('input[name="id"]').value = '';
            form.querySelector('input[name="artist"]').value = '';
            form.querySelector('input[name="title"]').value = '';
            form.querySelector('input[name="minutes"]').value = '';
            form.querySelector('input[name="year"]').value = '';
            form.querySelector('select[name="category"]').value = '';
        }

        function addMusicToTable(music) {
            const tbody = document.querySelector('#musicTable tbody');
            const row = tbody.insertRow();
            row.setAttribute('id', music.id);

            row.insertCell().textContent = music.id;
            row.insertCell().textContent = music.artist;
            row.insertCell().textContent = music.title;
            row.insertCell().textContent = music.minutes;
            row.insertCell().textContent = music.year;
            row.insertCell().textContent = music.category;

            const updateCell = row.insertCell();
            updateCell.innerHTML = `<button class="btn btn-sm btn-warning text-white" onclick="showUpdate(this)">
                <i class="bi bi-pencil"></i> Update</button>`;

            const deleteCell = row.insertCell();
            deleteCell.innerHTML = `<button class="btn btn-sm btn-danger" onclick="doDelete(this)">
                <i class="bi bi-trash"></i> Delete</button>`;
        }

        function createMusicAjax(music) {
            $.ajax({
                url: "/musics",
                method: "POST",
                data: JSON.stringify(music),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (result) {
                    music.id = result.id;
                    addMusicToTable(music);
                    clearForm();
                    showViewAll();
                },
                error: function (xhr, status, error) {
                    console.error("Error:", status, error);
                }
            });
        }

        function getAllAjax() {
            $.ajax({
                url: "/musics",
                method: "GET",
                dataType: "json",
                success: function (result) {
                    for (let music of result) {
                        addMusicToTable(music);
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error:", status, error);
                }
            });
        }

        function cancel() {
            clearForm();
            showViewAll();
        }

        // Load data on page load
        getAllAjax();
    </script>
</body>

</html>